---
- hosts: basic
  vars:
    user_vars: 
      username: "admin"
      groups: "wheel"
      append_group: yes
      create: present
      delete: no
      keyname: "1" 
    
  tasks:
    - name: "Add non-root user(s)"
      user:
        name: "{{ item.username }}"
        groups: "{{ item.groups }}"
        append: "{{ item.append_group }}"
        state: "{{ item.create }}"
        remove: "{{ item.delete }}"
      with_items: 
        - "{{ user_vars }}"
      tags: basic
    
    - name: "Set authorized keys taken from url"
      authorized_key:
        user: "{{ item.username }}"
        state: "{{ item.create }}"
        key: "https://github.com/ea-p/SecureVPS/blob/master/SecureVPS/files/{ item.keyname }}.pub"
      with_items: 
        - "{{ user_vars }}"
      tags: basic